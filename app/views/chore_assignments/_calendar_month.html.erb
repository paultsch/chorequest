<%# Month grid calendar. Locals: assignments_by_date (Hash<String,Array>), year, month, selected_child %>
<div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">

  <%# Day-of-week header %>
  <div class="grid grid-cols-7 border-b border-gray-100">
    <% %w[Sun Mon Tue Wed Thu Fri Sat].each do |day_name| %>
      <div class="py-2 text-center text-xs font-semibold text-gray-400 uppercase tracking-wide">
        <span class="hidden sm:inline"><%= day_name %></span>
        <span class="sm:hidden"><%= day_name[0] %></span>
      </div>
    <% end %>
  </div>

  <%# Weeks %>
  <% calendar_weeks(year, month).each do |week| %>
    <div class="grid grid-cols-7 divide-x divide-gray-100 border-b border-gray-100 last:border-b-0">
      <% week.each do |date| %>
        <% day_assignments = assignments_by_date[date.to_s] || [] %>
        <% in_month = date.month == month %>
        <% is_today = date == Date.current %>

        <% day_bg = in_month ? 'bg-white' : 'bg-gray-50' %>
        <div class="min-h-[72px] sm:min-h-[90px] p-1 relative transition-colors hover:bg-blue-50 <%= day_bg %>"
             data-scheduler-target="day"
             data-date="<%= date.iso8601 %>"
             data-child-id="<%= selected_child&.id %>"
             data-action="dragover->scheduler#dragOver
                          dragleave->scheduler#dragLeave
                          drop->scheduler#drop
                          click->scheduler#dayClicked">

          <%# Date number %>
          <div class="flex justify-start mb-0.5">
            <% date_classes = if is_today
                 'w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold'
               elsif in_month
                 'text-xs font-semibold text-gray-700'
               else
                 'text-xs font-semibold text-gray-300'
               end %>
            <span class="<%= date_classes %>"><%= date.day %></span>
          </div>

          <%# Assignment chips %>
          <div data-scheduler-target="chipContainer" class="space-y-0.5 overflow-hidden">
            <% day_assignments.each do |assignment| %>
              <%= render 'chore_chip', assignment: assignment %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

</div>

<% if selected_child.nil? %>
  <p class="mt-3 text-center text-sm text-gray-400">Select a child above to see their assignments.</p>
<% end %>
