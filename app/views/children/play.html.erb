<div class="max-w-3xl mx-auto py-8">
  <h1 class="text-2xl font-bold mb-4">Choose a game to play</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <% @games.each do |game| %>
      <div class="p-4 bg-white rounded-lg shadow-sm border">
        <div class="flex items-start justify-between">
          <div>
            <div class="text-lg font-semibold"><%= game.name %></div>
            <div class="text-sm text-gray-600"><%= truncate(game.description.to_s, length: 120) %></div>
            <div class="text-sm text-orange-600 mt-2"><%= game.token_per_minute %> ðŸª™ / min</div>
          </div>
          <div class="text-right">
            <%# Use public start path when rendered from public token; use local submit to follow redirects %>
            <% action_path = params[:token].present? ? public_start_session_path(params[:token]) : start_session_child_path(@child) %>
            <%= form_with url: action_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :game_id, game.id %>
              <% if @child.token_balance <= 0 %>
                <button class="px-3 py-2 rounded bg-gray-300 text-gray-700" disabled>Not enough tokens</button>
              <% else %>
                <%= f.submit 'Start', class: 'px-3 py-2 rounded bg-green-500 text-white' %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-6"><%= link_to 'Back', child_path(@child), class: 'text-sm text-gray-600' %></div>
</div>
