<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChoreQuest</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gradient-to-br from-yellow-50 via-green-50 to-blue-50 min-h-screen">
    <!-- Top Navigation Bar -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
      <div class="flex items-center justify-between px-4 py-4 max-w-7xl mx-auto">
        <div class="flex items-center gap-4">
          <button id="menu-toggle" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">CQ</div>
            <h1 class="text-xl font-bold text-gray-800 hidden sm:block">ChoreQuest</h1>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <% if parent_signed_in? %>
            <div class="text-sm text-gray-600" >
              <%= current_parent.name %>
            </div>
            <%= button_to destroy_parent_session_path, method: :delete, class: "px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold text-sm transition-all duration-200" do %>
              Sign Out
            <% end %>
          <% elsif session[:child_id] %>
            <div class="text-sm text-gray-600">
              <%= Child.find(session[:child_id]).name %>
            </div>
            <%= link_to destroy_child_session_path, method: :delete, class: "px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold text-sm transition-all duration-200" do %>
              Sign Out
            <% end %>
          <% else %>
            <div class="flex gap-2">
              <%= link_to "Parent Login", new_parent_session_path, class: "px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 font-semibold text-sm transition-all duration-200" %>
              <%= link_to "Child Login", new_child_session_path, class: "px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold text-sm transition-all duration-200" %>
            </div>
          <% end %>
        </div>
      </div>
    </nav>

    <div class="flex">
      <!-- Sidebar Navigation -->
      <aside id="sidebar" class="hidden md:flex flex-col w-64 bg-white shadow-lg fixed left-0 top-16 h-[calc(100vh-4rem)] overflow-y-auto">
        <nav class="p-4 space-y-2">
          <% if parent_signed_in? %>
            <!-- Parent Navigation -->
            <%= link_to admin_root_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">ğŸ“Š Dashboard</span>
            <% end %>
            
            <%= link_to children_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">ğŸ‘¶ Children</span>
            <% end %>
            
            <%= link_to chores_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">âœ“ Chores</span>
            <% end %>
            
            <%= link_to chore_assignments_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">ğŸ“‹ Assignments</span>
            <% end %>
            
            <%= link_to games_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">ğŸ® Games</span>
            <% end %>
            
            <%= link_to token_transactions_path, class: "block px-4 py-2 rounded-lg hover:bg-blue-50 text-gray-700 hover:text-blue-600 transition" do %>
              <span class="font-medium">ğŸ’° Tokens</span>
            <% end %>
          <% elsif session[:child_id] %>
            <!-- Child Navigation -->
            <% child = Child.find(session[:child_id]) %>
            <%= link_to child_path(child), class: "block px-4 py-2 rounded-lg hover:bg-green-50 text-gray-700 hover:text-green-600 transition" do %>
              <span class="font-medium">ğŸ  Home</span>
            <% end %>
            
            <%= link_to games_path, class: "block px-4 py-2 rounded-lg hover:bg-green-50 text-gray-700 hover:text-green-600 transition" do %>
              <span class="font-medium">ğŸ® Games</span>
            <% end %>
          <% end %>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 md:ml-64">
        <div class="max-w-6xl mx-auto p-4 md:p-8">
          <% if notice %>
            <div class="mb-6 p-4 bg-green-50 border-l-4 border-green-500 text-green-700 rounded-lg">
              <%= notice %>
            </div>
          <% end %>
          
          <% if alert %>
            <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg">
              <%= alert %>
            </div>
          <% end %>

          <%= yield %>
        </div>
      </main>
    </div>

    <script>
      // Mobile menu toggle
      document.getElementById('menu-toggle')?.addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('hidden');
      });
    </script>
  </body>
</html>
