<div class="max-w-3xl mx-auto py-8">
  <h1 class="text-2xl font-bold mb-1">Hi <%= @child.name %> â€” Today's Chores</h1>
  <div class="text-sm text-gray-600 mb-4"><%= l(Date.current, format: :long) %></div>

  <% if @assignments.empty? %>
    <div class="p-4 bg-gray-50 rounded">No chores for today. Great job!</div>
  <% else %>
    <div class="space-y-4">
      <% @assignments.each do |assignment| %>
          <div class="p-4 bg-white rounded shadow-sm flex items-center justify-between">
            <div>
              <div class="font-semibold"><%= assignment.chore&.name || 'Chore' %></div>
              <div class="text-sm text-gray-600"><%= assignment.chore&.definition_of_done %></div>
            </div>
            <div>
              <% if assignment.completed %>
                <div class="flex items-center gap-2">
                  <span class="px-3 py-1 rounded bg-green-100 text-green-800">Completed</span>
                    <% if assignment.approved.nil? %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Awaiting approval</span>
                    <% elsif assignment.approved == true %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-800">Approved</span>
                    <% end %>
                </div>
              <% else %>
                <%= button_to public_complete_assignment_path(params[:token], assignment), method: :post, class: 'px-3 py-2 bg-indigo-600 text-white rounded' do %>
                  Mark Done
                <% end %>
              <% end %>
            </div>
          </div>
      <% end %>
    </div>
  <% end %>

    <%# Show Play button when all today's chores are completed and approved %>
    <% todays_ready = @assignments.any? && @assignments.all? { |a| a.completed == true && a.approved == true } %>
    <% if todays_ready %>
    <div class="mt-6">
      <%= link_to 'Play games', public_play_path(params[:token]), class: 'inline-block px-3 py-2 bg-indigo-600 text-white rounded shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500' %>
    </div>
  <% end %>


  <hr class="my-8">

  <h2 class="text-xl font-bold mb-3">Upcoming chores (next 90 days)</h2>

  <% if @upcoming.blank? %>
    <div class="p-4 bg-gray-50 rounded">No upcoming chores scheduled.</div>
  <% else %>
    <% upcoming_grouped = @upcoming.group_by(&:scheduled_on) %>
    <div class="space-y-6">
      <% upcoming_grouped.each do |date, items| %>
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2"><%= l(date, format: :long) %></h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <% items.each do |assignment| %>
                <div class="p-4 bg-white rounded shadow-sm flex items-center justify-between">
                  <div>
                    <div class="font-semibold"><%= assignment.chore&.name || 'Chore' %></div>
                    <div class="text-sm text-gray-600"><%= assignment.chore&.definition_of_done %></div>
                  </div>
                  <div>
                    <% if assignment.completed %>
                      <div class="flex items-center gap-2">
                        <span class="px-3 py-1 rounded bg-green-100 text-green-800">Completed</span>
                        <% if assignment.approved.nil? %>
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Awaiting approval</span>
                        <% elsif assignment.approved == false %>
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Rejected</span>
                        <% end %>
                      </div>
                    <% else %>
                      <span class="px-3 py-1 rounded bg-gray-100 text-gray-800">Upcoming</span>
                    <% end %>
                  </div>
                </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
